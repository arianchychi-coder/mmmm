<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
<title>Surveillance</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f1f1f1;
    color: #333;
}

.header {
    background: #FFF;
    padding: 20px;
    text-align: center;
    font-size: 22px;
    letter-spacing: 1px;
}

.container {
    width: 95%;
    max-width: 1200px;
    margin: 30px auto;
}

.status-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    background: #fff;
    padding: 15px;
    border-radius: 10px;
}

.status {
    color: #4ade80;
    font-weight: bold;
}

.controls {
    display: flex;
    gap: 10px;
}

button {
    padding: 8px 15px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
}

.record {
    background: #ef4444;
    color: white;
}

.review {
    background: #2563eb;
    color: white;
}

.grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.camera {
    background: #fff;
    border-radius: 12px;
    padding: 15px;
    position: relative;
}

.camera-screen {
    background: #eee;
    height: 200px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #9ca3af;
    font-size: 14px;
}

.camera h4 {
    margin: 10px 0 5px;
}

.online {
    color: #4ade80;
    font-size: 13px;
}

 .offline {
    color: #ef4444;
    font-size: 13px;
}

/* Responsive */
@media (max-width: 800px) {
    .grid {
        grid-template-columns: 1fr;
    }
}
</style>

</head>
<body>

<div class="header">
    Surveillance Monitoring System
</div>

<div class="container">

    <a href="/api/page/2/authpage" style="color: #333;font-size: 3rem; position: relative; bottom: 1rem;right: 10rem;">
            <i class="bi bi-arrow-left"></i>
        </a>

    <div class="status-bar">
        <div id="onlinebox">
            System Status: <span class="status" id="online">ONLINE</span>
        </div>

        <div class="controls">
            <button class="record" id="recordBtn">Start Recording</button>
            <button class="review">Review Footage</button>
        </div>
    </div>

    <div class="grid">

        <div class="camera">
            <video class="camera-screen" id="cam1" autoplay playsinline style="width:100%;background-position: center; background-size: cover;"></video>
            <h4>Front Door Camera</h4>
            <button class="online" id="active"> <span id="sosok">● Online</span> </button>
        </div>

        <div class="camera">
            <video class="camera-screen" id="cam2" autoplay playsinline style="width:100%;background-position: center; background-size: cover;"></video>
            <h4>Backyard Camera</h4>
            <button class="online" id="active2"> <span id="sosok2">● Online</span> </button>
        </div>

        <div class="camera">
            <video class="camera-screen" id="cam3" autoplay playsinline style="width:100%;background-position: center; background-size: cover;"></video>
            <h4>Garage Camera</h4>
            <button class="online" id="active3"> <span id="sosok3">● Online</span> </button>
        </div>

        <div class="camera">
           <video class="camera-screen" id="cam4" autoplay playsinline style="width:100%;background-position: center; background-size: cover;"></video>
            <h4>Living Room Camera</h4>
            <button class="online" id="active4"> <span id="sosok4">● Online</span> </button>
        </div>

    </div>

</div>

<script>
    let mediaRecorder;
let recordedChunks = [];
let stream;

async function startCamera() {
    try {
        stream = await navigator.mediaDevices.getUserMedia({
            video: true,
            audio: true
        });

        document.getElementById("cam1").srcObject = stream; 
        document.getElementById("cam2").srcObject = stream
        document.getElementById("cam3").srcObject = stream
        document.getElementById("cam4").srcObject = stream

    } catch (error) {
        alert("اجازه دسترسی به دوربین داده نشد.");
        console.error(error);
    }
}

function startRecording() {
    recordedChunks = [];
    mediaRecorder = new MediaRecorder(stream);

    mediaRecorder.ondataavailable = function (event) {
        if (event.data.size > 0) {
            recordedChunks.push(event.data);
        }
    };

    mediaRecorder.onstop = function () {
        const blob = new Blob(recordedChunks, {
            type: "video/webm"
        });

        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "recorded-video.webm";
        a.click();
    };

    mediaRecorder.start();
}

function stopRecording() {
    mediaRecorder.stop();
}

startCamera();

const recordBtn = document.getElementById("recordBtn");

let isRecording = false;

recordBtn.addEventListener("click", () => {
    if (!isRecording) {
        startRecording();
        recordBtn.textContent = "Stop Recording";
        recordBtn.style.background = "#16a34a";
        isRecording = true;
    } else {
        stopRecording();
        recordBtn.textContent = "Start Recording";
        recordBtn.style.background = "#ef4444";
        isRecording = false;
    }
});


const active= document.getElementById("active")
const sosok = document.getElementById("sosok")

let Active = false

active.addEventListener("click",function(){
    if (!Active) {
        
        sosok.style =`
        color : red;`
        sosok.innerHTML = "● offline"
        document.getElementById("cam1").style.display = "none"
        Active = true
    }
    else{
        sosok.style =`
        color : #4ade80`
        sosok.innerHTML = "● online"
        document.getElementById("cam1").style.display = ""
        Active = false
    }
    
})

const active2= document.getElementById("active2")
const sosok2 = document.getElementById("sosok2")

let Active2 = false

active2.addEventListener("click",function(){
    if (!Active2) {
        
        sosok2.style =`
        color : red;`
        sosok2.innerHTML = "● offline"
        document.getElementById("cam2").style.display = "none"
        Active2 = true
    }
    else{
        sosok2.style =`
        color : #4ade80`
        sosok2.innerHTML = "● online"
        document.getElementById("cam2").style.display = ""
        Active2 = false
    }
    
})


const active3= document.getElementById("active3")
const sosok3 = document.getElementById("sosok3")

let Active3 = false

active3.addEventListener("click",function(){
    if (!Active3) {
        
        sosok3.style =`
        color : red;`
        sosok3.innerHTML = "● offline"
        document.getElementById("cam3").style.display = "none"
        Active3 = true
    }
    else{
        sosok3.style.color = `#4ade80`
        sosok3.innerHTML = "● online"
        document.getElementById("cam3").style.display = ""
        Active3 = false
    }
    
})



const active4= document.getElementById("active4")
const sosok4 = document.getElementById("sosok4")

let Active4 = false

active4.addEventListener("click",function(){
    if (!Active4) {
        
        sosok4.style =`
        color : red;`
        sosok4.innerHTML = "● offline"
        document.getElementById("cam4").style.display = "none"
        Active4 = true
    }
    else{
        sosok4.style.color = `#4ade80`
        sosok4.innerHTML = "● online"
        document.getElementById("cam4").style.display = ""
        Active4 = false
    }
    
})



</script>
<script src="/js/surveillance.js"></script>
</body>
</html>